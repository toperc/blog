{"title":"Android开发之SQLite使用详解","date":"2019-03-07T15:11:30.000Z","date_formatted":{"ll":"2019年3月7日","L":"2019/03/07","MM-DD":"03-07"},"link":"post/1551971490","comments":true,"tags":["SQLite"],"categories":["Android"],"updated":"2021-01-14T08:08:54.897Z","content":"<p>Android开发中数据库框架是越来越多了，前段时间总结了一篇针对GreenDao的使用，不过这玩意官方不在维护了，但以目前的还是有很多公司在用。而Android上SQLite似乎永远也不会过时，这两年Google官方主推Room数据库框架，Room持久型类库在SQLite的基础上提供了一个抽象层，方便大家流利的访问数据库。并且，利用了SQlite的全部强大功能。</p>\n<a id=\"more\"></a>\n<h2 id=\"sqlite的文件结构\">SQLite的文件结构<a title=\"#sqlite的文件结构\" href=\"#sqlite的文件结构\"></a></h2>\n<p>使用SQLite主要注意三个类：SQLiteOpenHelper、SQLiteDatabase、XXXDAO。</p>\n<p>SQLiteOpenHelper主要用于数据库的库名、版本、表创建、升级、降级等重要操作。</p>\n<p>SQLiteDatabase主要用于数据库语句的相关执行。</p>\n<p>XXXDAO的目的就是封装我们常用的增删改查操作，配合SQLiteOpenHelper和SQLiteDatabase的使用，在项目中调用操作主要用的是这个DAO类。</p>\n<h2 id=\"sqliteopenhelper\">SQLiteOpenHelper<a title=\"#sqliteopenhelper\" href=\"#sqliteopenhelper\"></a></h2>\n<p>SQLiteOpenHelper是一个抽象类，平时使用我们需要创建一个类继承SQLiteOpenHelper。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DBOpenHelper</span> <span class=\"keyword\">extends</span> <span class=\"title\">SQLiteOpenHelper</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String DATABASE_NAME = <span class=\"string\">&quot;word.db&quot;</span>;  </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> DATABASE_VERSION = <span class=\"number\">1</span>;  </span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">DBOpenHelper</span><span class=\"params\">(Context context)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">super</span>(context, DATABASE_NAME, <span class=\"keyword\">null</span>, DATABASE_VERSION);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 1、在第一次打开数据库的时候才会走</span></span><br><span class=\"line\"><span class=\"comment\">     * 2、在清除数据之后再次运行--&gt;打开数据库，这个方法会走</span></span><br><span class=\"line\"><span class=\"comment\">     * 3、没有清除数据，不会走这个方法</span></span><br><span class=\"line\"><span class=\"comment\">     * 4、数据库升级的时候这个方法不会走</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(SQLiteDatabase db)</span> </span>&#123;</span><br><span class=\"line\">\t\t db.execSQL(<span class=\"string\">&quot;CREATE TABLE IF NOT EXISTS userinfo (id integer primary key autoincrement, userid int, plan int, yet_num_day int, yet_num_all int, select_sort int, username text, userphoto text, oldwordsort text, sort_word text, time text)&quot;</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 1、这个方法只有当数据库已经存在，而且版本升高的时候，才会调用</span></span><br><span class=\"line\"><span class=\"comment\">     * 2、第一次创建数据库的时候，这个方法不会走</span></span><br><span class=\"line\"><span class=\"comment\">     * 3、清除数据后再次运行(相当于第一次创建)这个方法也不会走</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onUpgrade</span><span class=\"params\">(SQLiteDatabase db, <span class=\"keyword\">int</span> oldVersion, <span class=\"keyword\">int</span> newVersion)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"创建数据库表\">创建数据库表<a title=\"#创建数据库表\" href=\"#创建数据库表\"></a></h3>\n<p>SQLite也是有生命周期的，其中最重要的一个方法就是onCreate，我们常常在这里初始化一些表的定义。<code>db.execSQL()</code>可直接进行编写SQL语句。</p>\n<p>这里顺便提一下SQLiteDatabase的<code>execSQL()</code>和<code>rawQuery()</code>方法，这两个方法都是用于执行SQL语句，后边的增删改查中都离不开，他们两个使用区别也很简单，一句话说就是<strong>凡是需要数据改动的使用execSQL()，查询使用rawQuery()</strong>。</p>\n<h3 id=\"数据库升级\">数据库升级<a title=\"#数据库升级\" href=\"#数据库升级\"></a></h3>\n<p>一般我们的数据库表结构需要在新版本发生变化时，就要对数据库进行升级了，需要调高一个版本号。</p>\n<p>SQLite提供了<code>ALTER TABLE</code>命令，允许用户重命名或添加新的字段到已有表中，但是不能从表中删除字段。并且只能在表的末尾添加字段，</p>\n<p>数据库升级大概有以下几种情况：</p>\n<p>1.在老表基础上新增字段</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onUpgrade</span><span class=\"params\">(SQLiteDatabase db, <span class=\"keyword\">int</span> oldVersion, <span class=\"keyword\">int</span> newVersion)</span> </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">switch</span> (oldVersion) &#123;</span><br><span class=\"line\">           <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                <span class=\"comment\">//这里的数值是上次的版本，也就是针对上次的版本，本次的版本要做哪些改变</span></span><br><span class=\"line\">                <span class=\"comment\">//这种情况需要同时在onCreate中加上执行新增字段的创建表sql(针对新用户)</span></span><br><span class=\"line\">                db.execSQL(<span class=\"string\">&quot;ALTER TABLE TableEvent.CREATE_SQL ADD COLUMN TableEvent.xxx VARCHAR(255)&quot;</span>);</span><br><span class=\"line\">           <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>2.在之前基础上创建新的表</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onUpgrade</span><span class=\"params\">(SQLiteDatabase db, <span class=\"keyword\">int</span> oldVersion, <span class=\"keyword\">int</span> newVersion)</span> </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">switch</span> (oldVersion) &#123;</span><br><span class=\"line\">           <span class=\"keyword\">case</span> <span class=\"number\">1</span>:   </span><br><span class=\"line\">                <span class=\"comment\">//这里的数值是上次的版本，也就是针对上次的版本，本次的版本要做哪些改变</span></span><br><span class=\"line\">                <span class=\"comment\">//这种情况需要同时在onCreate中加上执行新表的创建sql(新用户)</span></span><br><span class=\"line\">                db.execSQL(<span class=\"string\">&quot;CREATE TABLE IF NOT EXISTS newword (id integer primary key autoincrement, userid int, sort int, word text, soundmark text, explain text, example text, translate text)&quot;</span>);</span><br><span class=\"line\">           <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>3.数据库升级时保留老的数据并同步到新的表当中</p>\n<p>这种情况是新表保留老表的字段结构情况</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onUpgrade</span><span class=\"params\">(SQLiteDatabase db, <span class=\"keyword\">int</span> oldVersion, <span class=\"keyword\">int</span> newVersion)</span> </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">switch</span> (oldVersion) &#123;</span><br><span class=\"line\">           <span class=\"keyword\">case</span> <span class=\"number\">1</span>:<span class=\"comment\">//这里的数值是上次的版本，也就是针对上次的版本，本次的版本要做哪些改变</span></span><br><span class=\"line\">                <span class=\"comment\">//老的表重命名</span></span><br><span class=\"line\">                String CREATE_TEMP_BOOK = <span class=\"string\">&quot;alter table book rename to _temp_book&quot;</span>;</span><br><span class=\"line\">                <span class=\"comment\">//创建新的表，表名跟原来一样，并保留原来的字段</span></span><br><span class=\"line\">                String CREATE_BOOK = <span class=\"string\">&quot;create table book(bookId integer primarykey, bookName text);&quot;</span>;</span><br><span class=\"line\">                <span class=\"comment\">//将重命名后的老表中的数据导入新的表中</span></span><br><span class=\"line\">                String INSERT_DATA = <span class=\"string\">&quot;insert into book select *,&#x27;&#x27; from _temp_book&quot;</span>;</span><br><span class=\"line\">                <span class=\"comment\">//删除老表</span></span><br><span class=\"line\">                String DROP_BOOK = <span class=\"string\">&quot;drop table _temp_book&quot;</span>;</span><br><span class=\"line\">                db.execSQL(CREATE_TEMP_BOOK);</span><br><span class=\"line\">                <span class=\"comment\">//这句要同时放到onCreate中，针对新用户</span></span><br><span class=\"line\">                db.execSQL(CREATE_BOOK);</span><br><span class=\"line\">                db.execSQL(INSERT_DATA);</span><br><span class=\"line\">                db.execSQL(DROP_BOOK);</span><br><span class=\"line\">           <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>4.跨版本升级</p>\n<p>前面几种情况是单级升级的时候，针对上次的版本本次的版本需要做的处理，如果是跨级升级，比如用户app很久没有更新了，这次升级数据库版本从1升到了3，或者2升到了6，这时需要分开处理每次的版本：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onUpgrade</span><span class=\"params\">(SQLiteDatabase db, <span class=\"keyword\">int</span> oldVersion, <span class=\"keyword\">int</span> newVersion)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (oldVersion) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                db.execSQL(CREATE_TBL_CATEGORY)  <span class=\"comment\">// 建立新表</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                db.execSQL(<span class=\"string\">&quot;ALTER TABLE Book ADD COLUMN category_id INTEGER&quot;</span>);  <span class=\"comment\">// 增加字段</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">                <span class=\"comment\">//同步老的数据到新的表</span></span><br><span class=\"line\">                String CREATE_TEMP_BOOK = <span class=\"string\">&quot;alter table book rename to _temp_book&quot;</span>;</span><br><span class=\"line\">                String CREATE_BOOK = <span class=\"string\">&quot;create table book(bookId integer primarykey, bookName text);&quot;</span>;</span><br><span class=\"line\">                String INSERT_DATA = <span class=\"string\">&quot;insert into book select *,&#x27;&#x27; from _temp_book&quot;</span>;</span><br><span class=\"line\">                String DROP_BOOK = <span class=\"string\">&quot;drop table _temp_book&quot;</span>;</span><br><span class=\"line\">                db.execSQL(CREATE_TEMP_BOOK);</span><br><span class=\"line\">                db.execSQL(CREATE_BOOK);</span><br><span class=\"line\">                db.execSQL(INSERT_DATA);</span><br><span class=\"line\">                db.execSQL(DROP_BOOK);</span><br><span class=\"line\">        <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>注意，这里OnUpgrade() 方法中的 switch 语句是没有 break 的，会一直执行到语句结束。为什么要这么写想想就明白了。比如用户手上的版本是 1，新版 App 的版本是 5，那么就会有 4 个版本的数据库升级，switch() 自然不能中途 break，必须执行这 4 个版本的数据库升级语句。同时每次的case中添加的创建新表的sql代码不要忘了在onCreate中同时添加，因为新用户也是要执行的。</p>\n<p><strong>另外在执行这些sql语句时，个人建议最好加一个事务来进行处理，来保证整个流程的完整性。</strong></p>\n<h3 id=\"数据库降级\">数据库降级<a title=\"#数据库降级\" href=\"#数据库降级\"></a></h3>\n<p>针对数据库降级，我们需要重写<code>onDowngrade()</code>方法，使用形式和数据库升级数据迁移的步骤一样：</p>\n<ol>\n<li>重命名老表为备份表</li>\n<li>创建新表</li>\n<li>数据迁移</li>\n<li>删除备份表</li>\n</ol>\n<p>一般情况我们很少用到数据库降级操作，如果真的需要数据还原，还是直接数据库升级处理最好。</p>\n<h2 id=\"dao\">DAO<a title=\"#dao\" href=\"#dao\"></a></h2>\n<p>DAO类的目的就是封装我们常用的增删改查操作。前边我们说过数据库的语句执行主要用到的是SQLiteDatabase，获取SQLiteDatabase对象的方式有两种：</p>\n<ol>\n<li>SQLiteOpenHelper的getWritableDatabase()，此方法主要用于数据的增删改。</li>\n<li>SQLiteOpenHelper的getReadableDatabase()，此方法主要用于数据的查询。</li>\n</ol>\n<p>需要说明的是getWritableDatabase()和getReadableDatabase()伴随着资源和内存的消耗，一定要记着关闭；另外这两个方法的开启相对来说也是耗时的，所以也不要频繁的开启，因此我们在操作的过程中要合适的去处理这两件事，例如我会在使用的时候开启一次，而在页面销毁的时候统一关闭。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserInfoDAO</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> DBOpenHelper openHelper;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> SQLiteDatabase db;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//生成数据库对象并开启数据库</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">UserInfoDAO</span><span class=\"params\">(Context context)</span> </span>&#123;</span><br><span class=\"line\">\t\topenHelper = <span class=\"keyword\">new</span> DBOpenHelper(context);</span><br><span class=\"line\">\t\tdb = openHelper.getWritableDatabase();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//记录用户数据</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insert</span><span class=\"params\">(MyApplication application)</span> </span>&#123;</span><br><span class=\"line\">\t\tdb.execSQL(<span class=\"string\">&quot;insert into userinfo values(null,?,?,?,?,?,?,?,?,?,?)&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">new</span> Object[] &#123;application.getUserid(), application.getPlan(), application.getYet_num_day(), application.getYet_num_all(), application.getSelect_sort(), application.getUsername(), application.getUserphoto(), application.getOldwordsort(), application.getSort_word(), application.getTime()&#125;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//删除用户所有数据</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">deleteAll</span><span class=\"params\">(<span class=\"keyword\">int</span> userid)</span> </span>&#123;</span><br><span class=\"line\">\t\tdb.execSQL(<span class=\"string\">&quot;delete from userinfo where userid = ?&quot;</span>,<span class=\"keyword\">new</span> String[]&#123;userid+<span class=\"string\">&quot;&quot;</span>&#125;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//更新计划</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">updatePlan</span><span class=\"params\">(<span class=\"keyword\">int</span> plan,<span class=\"keyword\">int</span> userid)</span> </span>&#123;</span><br><span class=\"line\">\t\tdb.execSQL(<span class=\"string\">&quot;update userinfo set plan= ? where userid=?&quot;</span>,<span class=\"keyword\">new</span> String[]&#123;plan+<span class=\"string\">&quot;&quot;</span>,userid+<span class=\"string\">&quot;&quot;</span>&#125;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//更新今日已学的单词数</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">updateYet_num_day</span><span class=\"params\">(<span class=\"keyword\">int</span> yet_num_day,<span class=\"keyword\">int</span> userid)</span> </span>&#123;</span><br><span class=\"line\">\t\tdb.execSQL(<span class=\"string\">&quot;update userinfo set yet_num_day= ? where userid=?&quot;</span>,<span class=\"keyword\">new</span> String[]&#123;yet_num_day+<span class=\"string\">&quot;&quot;</span>,userid+<span class=\"string\">&quot;&quot;</span>&#125;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//更新已学的单词数</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">updateYet_num_all</span><span class=\"params\">(<span class=\"keyword\">int</span> yet_num_all,<span class=\"keyword\">int</span> userid)</span> </span>&#123;</span><br><span class=\"line\">\t\tdb.execSQL(<span class=\"string\">&quot;update userinfo set yet_num_all= ? where userid=?&quot;</span>,<span class=\"keyword\">new</span> String[]&#123;yet_num_all+<span class=\"string\">&quot;&quot;</span>,userid+<span class=\"string\">&quot;&quot;</span>&#125;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//更新是否选择单元的标记值</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">updateSelect_sort</span><span class=\"params\">(<span class=\"keyword\">int</span> select_sort,<span class=\"keyword\">int</span> userid)</span> </span>&#123;</span><br><span class=\"line\">\t\tdb.execSQL(<span class=\"string\">&quot;update userinfo set select_sort= ? where userid=?&quot;</span>,<span class=\"keyword\">new</span> String[]&#123;select_sort+<span class=\"string\">&quot;&quot;</span>,userid+<span class=\"string\">&quot;&quot;</span>&#125;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//更新背过的单元</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">updateOldSort</span><span class=\"params\">(String oldwordsort,<span class=\"keyword\">int</span> userid)</span> </span>&#123;</span><br><span class=\"line\">\t\tdb.execSQL(<span class=\"string\">&quot;update userinfo set oldwordsort= ? where userid=?&quot;</span>,<span class=\"keyword\">new</span> String[]&#123;oldwordsort,userid+<span class=\"string\">&quot;&quot;</span>&#125;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//更新记录（第几单元的第几个单词）</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">updateSortWord</span><span class=\"params\">(String sort_word,<span class=\"keyword\">int</span> userid)</span> </span>&#123;</span><br><span class=\"line\">\t\tdb.execSQL(<span class=\"string\">&quot;update userinfo set sort_word= ? where userid=?&quot;</span>,<span class=\"keyword\">new</span> String[]&#123;sort_word,userid+<span class=\"string\">&quot;&quot;</span>&#125;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//更新日期</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">updateTime</span><span class=\"params\">(String time,<span class=\"keyword\">int</span> userid)</span> </span>&#123;</span><br><span class=\"line\">\t\tdb.execSQL(<span class=\"string\">&quot;update userinfo set time= ? where userid=?&quot;</span>,<span class=\"keyword\">new</span> String[]&#123;time,userid+<span class=\"string\">&quot;&quot;</span>&#125;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//查询某个用户是否存在</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">userExist</span><span class=\"params\">(<span class=\"keyword\">int</span> userid)</span> </span>&#123;</span><br><span class=\"line\">\t\t db=openHelper.getReadableDatabase();<span class=\"comment\">//如果只对数据进行读取，建议使用此方法</span></span><br><span class=\"line\">\t\t Cursor cursor=db.rawQuery(<span class=\"string\">&quot;select count (*) from userinfo where userid = ?&quot;</span>,<span class=\"keyword\">new</span> String[]&#123;userid+<span class=\"string\">&quot;&quot;</span>&#125;);</span><br><span class=\"line\">\t\t cursor.moveToFirst();<span class=\"comment\">//从第一条数据开始读取（计数）</span></span><br><span class=\"line\">\t\t <span class=\"keyword\">int</span> a = cursor.getInt(<span class=\"number\">0</span>); <span class=\"comment\">//获取总数目</span></span><br><span class=\"line\">\t\t cursor.close();</span><br><span class=\"line\">\t\t <span class=\"keyword\">if</span> (a&gt;<span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t \t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">\t\t &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">\t\t &#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//查询某个用户数据</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> HashMap&lt;String, Object&gt; <span class=\"title\">findUserInfo</span><span class=\"params\">(<span class=\"keyword\">int</span> userid)</span> </span>&#123;</span><br><span class=\"line\">\t\tdb = openHelper.getReadableDatabase();</span><br><span class=\"line\">\t\tCursor cursor = db.rawQuery(<span class=\"string\">&quot;select * from userinfo where userid = ?&quot;</span>,<span class=\"keyword\">new</span> String[]&#123;userid+<span class=\"string\">&quot;&quot;</span>&#125;);</span><br><span class=\"line\">\t\tHashMap&lt;String, Object&gt; map = <span class=\"keyword\">new</span> HashMap&lt;String, Object&gt;();</span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> (cursor.moveToNext()) &#123;</span><br><span class=\"line\">\t\t\tmap.put(<span class=\"string\">&quot;id&quot;</span>, cursor.getInt(cursor.getColumnIndex(<span class=\"string\">&quot;id&quot;</span>)));</span><br><span class=\"line\">\t\t\tmap.put(<span class=\"string\">&quot;userid&quot;</span>, cursor.getInt(cursor.getColumnIndex(<span class=\"string\">&quot;userid&quot;</span>)));</span><br><span class=\"line\">\t\t\tmap.put(<span class=\"string\">&quot;plan&quot;</span>, cursor.getInt(cursor.getColumnIndex(<span class=\"string\">&quot;plan&quot;</span>)));</span><br><span class=\"line\">\t\t\tmap.put(<span class=\"string\">&quot;yet_num_day&quot;</span>, cursor.getInt(cursor.getColumnIndex(<span class=\"string\">&quot;yet_num_day&quot;</span>)));</span><br><span class=\"line\">\t\t\tmap.put(<span class=\"string\">&quot;yet_num_all&quot;</span>, cursor.getInt(cursor.getColumnIndex(<span class=\"string\">&quot;yet_num_all&quot;</span>)));</span><br><span class=\"line\">\t\t\tmap.put(<span class=\"string\">&quot;select_sort&quot;</span>, cursor.getInt(cursor.getColumnIndex(<span class=\"string\">&quot;select_sort&quot;</span>)));</span><br><span class=\"line\">\t\t\tmap.put(<span class=\"string\">&quot;username&quot;</span>, cursor.getString(cursor.getColumnIndex(<span class=\"string\">&quot;username&quot;</span>)));</span><br><span class=\"line\">\t\t\tmap.put(<span class=\"string\">&quot;userphoto&quot;</span>, cursor.getString(cursor.getColumnIndex(<span class=\"string\">&quot;userphoto&quot;</span>)));</span><br><span class=\"line\">\t\t\tmap.put(<span class=\"string\">&quot;oldwordsort&quot;</span>, cursor.getString(cursor.getColumnIndex(<span class=\"string\">&quot;oldwordsort&quot;</span>)));</span><br><span class=\"line\">\t\t\tmap.put(<span class=\"string\">&quot;sort_word&quot;</span>, cursor.getString(cursor.getColumnIndex(<span class=\"string\">&quot;sort_word&quot;</span>)));</span><br><span class=\"line\">\t\t\tmap.put(<span class=\"string\">&quot;time&quot;</span>, cursor.getString(cursor.getColumnIndex(<span class=\"string\">&quot;time&quot;</span>)));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tcursor.close();</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> map;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//关闭数据库</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">closeDB</span><span class=\"params\">()</span> </span>&#123;  </span><br><span class=\"line\">        db.close();  </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>数据库的增删改查除了可以采用SQLiteDatabase的<code>execSQL()</code>和<code>rawQuery()</code>方法来执行相关SQLite语句，SQLiteDatabase也提供有额外的针对每种操作的处理形式。</p>\n<h3 id=\"增\">增<a title=\"#增\" href=\"#增\"></a></h3>\n<p>使用insert(String table, String nullColumnHack, ContentValues values)方法来插入，ContentValues内部实现就是HashMap，但是两者还是有差别的，ContenValues Key只能是String类型，Value只能存储基本类型的数据，像string，int之类的，不能存储对象。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ContentValues values = <span class=\"keyword\">new</span> ContentValues();</span><br><span class=\"line\">values.put(<span class=\"string\">&quot;name&quot;</span>,insert_data);</span><br><span class=\"line\">db.insert(<span class=\"string\">&quot;user&quot;</span>,<span class=\"keyword\">null</span>,values);</span><br></pre></td></tr></table></figure>\n<h3 id=\"删\">删<a title=\"#删\" href=\"#删\"></a></h3>\n<p>使用delete(String table,String whereClause,String[] whereArgs)，whereClause是删除条件，whereArgs是删除条件值数组。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">db.delete(<span class=\"string\">&quot;user&quot;</span>,<span class=\"string\">&quot;name=?&quot;</span>,<span class=\"keyword\">new</span> String[]&#123;delete_data&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"改\">改<a title=\"#改\" href=\"#改\"></a></h3>\n<p>使用update(String table,ContentValues values,String whereClause, String[] whereArgs)：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ContentValues values2 = <span class=\"keyword\">new</span> ContentValues();</span><br><span class=\"line\">values2.put(<span class=\"string\">&quot;name&quot;</span>, update_after_data);</span><br><span class=\"line\">db.update(<span class=\"string\">&quot;user&quot;</span>, values2, <span class=\"string\">&quot;name = ?&quot;</span>, <span class=\"keyword\">new</span> String[]&#123;update_before_data&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"查\">查<a title=\"#查\" href=\"#查\"></a></h3>\n<p>使用query(String table,String[] columns,String selection,String[] selectionArgs,String groupBy,String having,String orderBy,String limit);</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//创建游标对象</span></span><br><span class=\"line\">Cursor cursor = db.query(<span class=\"string\">&quot;user&quot;</span>, <span class=\"keyword\">new</span> String[]&#123;<span class=\"string\">&quot;name&quot;</span>&#125;, <span class=\"keyword\">null</span>, <span class=\"keyword\">null</span>, <span class=\"keyword\">null</span>, <span class=\"keyword\">null</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\"><span class=\"comment\">//利用游标遍历所有数据对象</span></span><br><span class=\"line\"><span class=\"comment\">//为了显示全部，把所有对象连接起来，放到TextView中</span></span><br><span class=\"line\">String textview_data = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">while</span>(cursor.moveToNext())&#123;</span><br><span class=\"line\">    String name = cursor.getString(cursor.getColumnIndex(<span class=\"string\">&quot;name&quot;</span>));</span><br><span class=\"line\">    textview_data = textview_data + <span class=\"string\">&quot;\\n&quot;</span> + name;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//关闭游标</span></span><br><span class=\"line\">cursor.close();</span><br><span class=\"line\"><span class=\"comment\">//显示数据</span></span><br><span class=\"line\">textView.setText(textview_data);</span><br></pre></td></tr></table></figure>\n<p>重要提示：<strong>一定要记着关闭游标</strong></p>\n<h2 id=\"总结\">总结<a title=\"#总结\" href=\"#总结\"></a></h2>\n<p>以上是我对SQLite的一个使用详解，SQLite是基础，目前Google主推Room数据建库存储框架也是基于SQLite，Room的使用很简单，大家可以去网上搜寻一下也可以参看官方文档。</p>\n","prev":{"title":"URL和URI的区别","link":"post/1552038469"},"next":{"title":"Android开发Gradle配置总结","link":"post/1543499481"},"plink":"https://blog.ixin.run/post/1551971490/","toc":[{"id":"sqlite的文件结构","title":"SQLite的文件结构","index":"1"},{"id":"sqliteopenhelper","title":"SQLiteOpenHelper","index":"2","children":[{"id":"创建数据库表","title":"创建数据库表","index":"2.1"},{"id":"数据库升级","title":"数据库升级","index":"2.2"},{"id":"数据库降级","title":"数据库降级","index":"2.3"}]},{"id":"dao","title":"DAO","index":"3","children":[{"id":"增","title":"增","index":"3.1"},{"id":"删","title":"删","index":"3.2"},{"id":"改","title":"改","index":"3.3"},{"id":"查","title":"查","index":"3.4"}]},{"id":"总结","title":"总结","index":"4"}],"reward":true,"copyright":{"custom":"转载请注明出处，谢谢支持。"}}